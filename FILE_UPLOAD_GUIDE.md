# 📎 文件上传功能使用指南

## 功能概述

在病人详情页的聊天界面中，你现在可以**随时上传文件**，AI会在回答问题时参考这些文件的内容。

## 🎯 主要特点

### 1. **始终可见**
- 文件上传功能现在始终显示在聊天界面顶部
- 不需要点击按钮才能看到上传选项
- 更加直观和易用

### 2. **智能分析**
- 上传文件后，AI会自动分析内容
- 生成简洁的医疗相关摘要
- 摘要会显示在文件卡片上

### 3. **AI集成**
- 上传的文件信息会自动包含在所有AI回复中
- AI会参考文件内容来回答问题
- 提供更加个性化和准确的医疗建议

### 4. **灵活管理**
- 随时查看已上传的文件信息
- 点击"🗑️ Remove"按钮可删除附件
- 删除后可以上传新文件

## 📍 使用位置

```
病人详情页面:
┌─────────────────────────────────────┐
│ ← Back to Dashboard                 │
├─────────────────────────────────────┤
│ ... (病人信息) ...                   │
├─────────────────────────────────────┤
│ 💬 Chat 界面（点击右下角聊天按钮）    │
│                                     │
│ ───────────────────────────────────│
│ 📎 Attach Files to Chat   ← 这里！ │
│                                     │
│ [拖放文件或点击选择文件]             │
│ Upload medical records, lab         │
│ results, images, or related docs    │
│ ───────────────────────────────────│
│                                     │
│ [聊天历史记录显示在这里]             │
│                                     │
│ [输入框: Ask about this patient...] │
│ [Send] [🎤 Voice]                   │
└─────────────────────────────────────┘
```

## 🚀 使用步骤

### 步骤 1: 进入聊天界面

1. 打开任意病人的详情页
2. 找不到聊天界面？向下滚动页面找到右下角的聊天按钮
3. 聊天界面会展开显示

### 步骤 2: 上传文件

1. 在聊天界面顶部找到 **"📎 Attach Files to Chat"** 部分
2. 点击或拖放文件到上传区域
3. 等待文件处理和AI分析完成

### 步骤 3: 查看分析结果

上传成功后，你会看到：
- ✅ 绿色的成功提示
- 文件名称
- AI生成的简短摘要
- 文件类型和大小信息

### 步骤 4: 开始对话

现在你可以：
- 问AI关于文件内容的问题
- AI的回答会参考文件中的信息
- 结合病人数据和文件内容提供综合建议

### 步骤 5: 管理文件（可选）

如果需要更换文件：
1. 点击 **"🗑️ Remove"** 按钮
2. 上传新的文件

## 📄 支持的文件类型

| 类型 | 格式 | 说明 |
|------|------|------|
| **文本文件** | .txt | 完全支持内容分析 |
| **PDF文档** | .pdf | 支持（需要PyPDF2库提取文本） |
| **Word文档** | .doc, .docx | 支持 |
| **图片文件** | .jpg, .jpeg, .png | 支持上传（需要视觉AI分析内容） |
| **数据文件** | .csv | 完全支持内容分析 |

## 💡 使用建议

### 适合上传的文件：

1. **实验室报告** - 最新的血液检查、影像学报告
2. **病历记录** - 其他医院的诊断记录
3. **用药清单** - 当前用药情况
4. **过敏信息** - 过敏原列表
5. **家族病史** - 家族遗传病史文档
6. **医学影像** - X光、CT、MRI图像
7. **护理笔记** - 护士记录的观察笔记

### 使用技巧：

- **及时上传**: 在开始提问之前先上传相关文件
- **相关性**: 上传与病人直接相关的医疗文档
- **文件大小**: 尽量控制在合理范围内（建议<10MB）
- **清晰度**: 如果是图片，确保文字清晰可读

## 🤖 AI如何使用文件

当你上传文件后，AI会：

1. **立即分析**: 读取文件内容并生成摘要
2. **上下文集成**: 将文件信息添加到病人上下文中
3. **智能引用**: 在回答问题时参考文件内容
4. **综合建议**: 结合病人数据和文件信息提供建议

## 📊 实际示例

### 示例 1: 上传实验室报告

```
1. 用户上传: "lab_results_2024.pdf"
2. AI分析: "Blood test results showing elevated glucose
   (180 mg/dL) and slightly high creatinine (1.4 mg/dL)"
3. 用户提问: "Should we adjust the treatment plan?"
4. AI回答: "Based on the uploaded lab results showing
   elevated glucose and creatinine, combined with the
   patient's existing diabetes diagnosis..."
```

### 示例 2: 上传用药清单

```
1. 用户上传: "current_medications.txt"
2. AI分析: "Patient is currently taking Metformin 500mg
   twice daily and Lisinopril 10mg once daily"
3. 用户提问: "Any drug interactions with the new prescription?"
4. AI回答: "Reviewing the current medications (Metformin
   and Lisinopril), there are no significant interactions
   with..."
```

## ⚠️ 注意事项

1. **隐私安全**: 确保上传的文件不包含敏感个人信息（除非在安全环境中）
2. **文件质量**: 文件内容应该清晰、完整
3. **一次一个**: 目前系统支持一次上传一个文件
4. **API密钥**: 需要有效的OpenAI API密钥才能使用AI分析功能

## 🔧 故障排除

### 问题1: 上传后没有看到分析

**解决方案**:
- 检查是否设置了OpenAI API密钥
- 确认文件格式是否支持
- 查看是否有错误提示

### 问题2: 文件上传失败

**解决方案**:
- 检查文件大小是否过大
- 确认文件格式在支持列表中
- 尝试重新上传

### 问题3: AI没有参考文件内容

**解决方案**:
- 确认文件已成功上传（看到绿色✅提示）
- 在提问时明确提到文件内容
- 检查文件内容是否可读（文本类型）

## 📞 获取帮助

如果遇到问题：
1. 检查本指南中的故障排除部分
2. 运行验证脚本: `python verify_file_upload.py`
3. 查看应用日志获取更多信息

---

**版本**: 1.0
**更新日期**: 2025-10-23
**功能状态**: ✅ 已上线
